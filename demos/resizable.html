<html>

<head>
<title>Flapjax Demo: Resizable Box</title>

<style type="text/css">

.handle {
  background-color: #000000;
  border: 1px solid #666666;
  color: #ffffff;
  position: absolute;
  font-family: sans-serif; 
  cursor: move;
  width: 10px;
  height: 10px;
}

.horzEdge {
  background-color: #eeeeee;
  border: 1px solid #666666;
  color: #ffffff;
  position: absolute;
  font-family: sans-serif; 
  cursor: move;
  width: 200px;
  height: 10px;
}


</style>

<script type="text/javascript" src="../fx/flapjax-impl.js"></script>
<script type="text/javascript" src="../fx/prototype.js"></script>
<script type="text/javascript">

function posB(t_) {
  var t = $(t_); // adds Prototype methods
  var f = function() { 
    var pos = t.cumulativeOffset();
    var size = t.getDimensions();
    return { left : pos.left, top: pos.top, 
             height: size.height, width: size.width }};

  return $E(t, "DOMAttrModified")
    .filterE(function(x) { return x.attrName == "style"; })
    .mapE(f)
    .startsWith(f());
}

// dragE(element) -> EventStream { left: int, top: int }
// From the Flapjax OOPSLA paper.
function dragE(target) {
  // moveEe :: EventStream (EventStream { left: int, top: int })
  var moveEe = extractEventE(target,'mousedown').mapE(function(md) {
    var startX = md.layerX;
    var startY = md.layerY;

    return extractEventE(document,'mousemove').mapE(function(mm) {
      // Stop the text from getting selected
       mm.preventDefault();

      return { element: target, // convenience
               left: mm.clientX - startX,  
               top: mm.clientY - startY };
    });
  });
  
  // dropEe :: EventStream (EventStream 'a)
  var dropEe = extractEventE(document,'mouseup').mapE(function() {
    return zeroE();
  });
  
  return switchE(mergeE(moveEe,dropEe));
}

function dragAction(posB) {
  posB.liftB(function(evt) { 
    evt.element.style.left = evt.left;
    evt.element.style.top = evt.top;
  });
};

function loader() {
  
  var topLeft 
    = dragE($('topLeftCorner'))
     .startsWith({ element: $('topLeftCorner'), left: 50, top: 50 });

  insertValueB(topLeft.liftB(function(p) { return p.left + 10 }),
               $('topEdge'), 'style', 'left');
  insertValueB(topLeft.liftB(function(p) { return p.top }),
               $('topEdge'), 'style', 'top');

  dragAction(topLeft);

  var topPos = posB($("topEdge"));

/*
  insertValueB(topPos.liftB(function(p) { return p.left + p.width; }),
               $('topRightCorner'), 'style', 'left');
  insertValueB(topPos.liftB(function(p) { return p.top; }),
               $('topRightCorner'), 'style', 'top');
*/

 
}

</script>
<link rel="stylesheet" href="/demo.css"/>
</head>

<body onload="loader()">

<div id="topLeftCorner" class="handle"></div>
<div id="topEdge" class="horzEdge"></div>
 <div id="topRightCorner" class="handle"></div>

<!--<div id="bottomLeftCorner" class="handle"></div>
<div id="bottomRightCorner" class="handle"></div>

<div id="rightEdge" class="edge"></div>
<div id="bottomEdge" class="edge"></div>
<div id="leftEdge" class="edge"></div>

<div id="dragTarget" class="handle"
</div>
-->
</body>

</html>
